schema: '2.0'
stages:
  load_datasets:
    cmd: python source/load_datasets.py
    deps:
    - path: source/load_datasets.py
      hash: md5
      md5: 465e349f4f7eb256d15bf94aa6837074
      size: 3071
    params:
      params.yaml:
        dataset.subset: HSN
        paths.noise_data: data/${dataset.subset}/noise
        paths.raw_data: data/${dataset.subset}/raw
        paths.raw_data_metadata: 
          data/${dataset.subset}/stage_results/raw_data_metadata.json
        paths.test_data: data/${dataset.subset}/test
    outs:
    - path: data/HSN/noise
      hash: md5
      md5: 33cbd73c389c9a3f0cb5fe8be066a877.dir
      size: 2070429
      nfiles: 3
    - path: data/HSN/stage_results/raw_data_metadata.json
      hash: md5
      md5: 9ae22232c09d4a1fc6771307e214347f
      size: 3978
    - path: data/HSN/test
      hash: md5
      md5: 2cb7977d6f1267dc0d2bc174896ac63f.dir
      size: 2080261
      nfiles: 3
  separate_audio:
    cmd: python source/separate_audio.py
    deps:
    - path: data/HSN/stage_results/raw_data_metadata.json
      hash: md5
      md5: 9ae22232c09d4a1fc6771307e214347f
      size: 3978
    - path: source/integrations/bird_mixit/source_separation.py
      hash: md5
      md5: c90bb775227a6fa2f8c0cb4eb1a7c2f5
      size: 13912
    - path: source/modules/dataset.py
      hash: md5
      md5: d2b7e18aa09bc29fee0b037c56d63016
      size: 23478
    - path: source/separate_audio.py
      hash: md5
      md5: 8fdb669c3defdc9860c40699376a1eee
      size: 4809
    params:
      params.yaml:
        paths.raw_data: data/${dataset.subset}/raw
        paths.source_separation_metadata: 
          data/${dataset.subset}/stage_results/source_separation_metadata.json
        source_separation:
          model_dir: resources/bird_mixit_model_checkpoints/output_sources4
          checkpoint: 
            resources/bird_mixit_model_checkpoints/output_sources4/model.ckpt-3223090
          sampling_rate: 22050
          max_duration_s: 30
          cpu_percentage: 0.8
          gb_per_worker: 1
    outs:
    - path: data/HSN/stage_results/source_separation_metadata.json
      hash: md5
      md5: 613e93f21ca7f3caa948aa1edb25c10e
      size: 726
  analyze_audio:
    cmd: conda run --no-capture-output -n birdnetlib python 
      source/analyze_audio.py
    deps:
    - path: data/HSN/stage_results/source_separation_metadata.json
      hash: md5
      md5: 613e93f21ca7f3caa948aa1edb25c10e
      size: 726
    - path: source/analyze_audio.py
      hash: md5
      md5: d41fd994fd077a404c418e61f24288f3
      size: 3809
    - path: source/integrations/birdnetlib/analyze.py
      hash: md5
      md5: c44725590eff6a4baf09869b0766b318
      size: 4849
    - path: source/modules/dataset.py
      hash: md5
      md5: d2b7e18aa09bc29fee0b037c56d63016
      size: 23478
    params:
      params.yaml:
        analysis:
          sampling_rate: 48000
        dataset.subset: HSN
        paths.analysis_metadata: 
          data/${dataset.subset}/stage_results/analysis_metadata.json
        paths.raw_data: data/${dataset.subset}/raw
    outs:
    - path: data/HSN/raw
      hash: md5
      md5: aa15b0444fa5d2f1206ccedc56ec76b8.dir
      size: 377002051
      nfiles: 28
    - path: data/HSN/stage_results/analysis_metadata.json
      hash: md5
      md5: 34f6f9c1f77ea3d315a558ff3e5813cd
      size: 726
  segment_audio:
    cmd: python source/segment_audio.py
    deps:
    - path: data/HSN/stage_results/analysis_metadata.json
      hash: md5
      md5: 34f6f9c1f77ea3d315a558ff3e5813cd
      size: 726
    - path: source/integrations/birdnetlib/detections.py
      hash: md5
      md5: 3c0dbd277f7731ed96dfedd64dc488db
      size: 2684
    - path: source/integrations/birdset/utils.py
      hash: md5
      md5: c7a7294ca115b886f81626d3bb6fb641
      size: 4414
    - path: source/modules/dsp.py
      hash: md5
      md5: 699f6cd0ffdacc40f36bf691ea7ebb08
      size: 28127
    - path: source/segment_audio.py
      hash: md5
      md5: 8c8f6de83caddd2912c5e4642db3fcdc
      size: 10312
    params:
      params.yaml:
        dataset.subset: HSN
        paths.raw_data: data/${dataset.subset}/raw
        paths.segmented_data: data/${dataset.subset}/segmented
        segmentation:
          segment_length_in_s: 5
    outs:
    - path: data/HSN/segmented
      hash: md5
      md5: 86f30a9e6e64ec11e39e91add81ecafc.dir
      size: 40602111
      nfiles: 5
  mix_audio:
    cmd: python source/mix_audio.py
    deps:
    - path: data/HSN/noise
      hash: md5
      md5: 4c721ba2904fef9d630a670df3f11019.dir
      size: 2071277
      nfiles: 4
    - path: data/HSN/segmented
      hash: md5
      md5: c300fa4488bec531a46760ef7a369d88.dir
      size: 40612511
      nfiles: 20
    - path: source/mix_audio.py
      hash: md5
      md5: 5b479007f83bcfd9c2b04380bd6961f4
      size: 22947
    - path: source/modules/dataset.py
      hash: md5
      md5: d2b7e18aa09bc29fee0b037c56d63016
      size: 23478
    - path: source/modules/dsp.py
      hash: md5
      md5: 699f6cd0ffdacc40f36bf691ea7ebb08
      size: 28127
    - path: source/modules/utils.py
      hash: md5
      md5: 3ad1ff008e642b50e5a2c71889c888ca
      size: 4431
    params:
      params.yaml:
        dataset.subset: HSN
        mix:
          max_polyphony_degree: 6
          num_iterations: 5
          max_time_shift_ratio: 0.2
          signal_levels:
          - -12
          - -11
          - -10
          - -9
          - -8
          - -7
          - -6
          - -5
          - -4
          - -3
          - -2
          - -1
          - 0
          snr_values:
          - -12
          - -11
          - -10
          - -9
          - -8
          - -7
          - -6
          - -5
          - -4
          - -3
          - -2
          - -1
          - 0
          - 1
          - 2
          - 3
          - 4
          - 5
          - 6
          - 7
          - 8
          - 9
          - 10
          - 11
          - 12
          mix_levels:
          - -12
          - -11
          - -10
          - -9
          - -8
          - -7
          - -6
          balance_dataset: false
        paths.noise_data: data/${dataset.subset}/noise
        paths.polyphonic_data: data/${dataset.subset}/polyphonic
        random.random_seed: 42
    outs:
    - path: data/HSN/polyphonic
      hash: md5
      md5: 59506a8a9ce98feb6a0936d496a802e6.dir
      size: 11508558
      nfiles: 13
  upload_dataset:
    cmd: python source/upload_dataset.py
    deps:
    - path: data/HSN/polyphonic
      hash: md5
      md5: 59506a8a9ce98feb6a0936d496a802e6.dir
      size: 11508558
      nfiles: 13
    - path: data/HSN/segmented
      hash: md5
      md5: c300fa4488bec531a46760ef7a369d88.dir
      size: 40612511
      nfiles: 20
    - path: source/modules/dsp.py
      hash: md5
      md5: 699f6cd0ffdacc40f36bf691ea7ebb08
      size: 28127
    - path: source/upload_dataset.py
      hash: md5
      md5: 8261c2ec1aebf261fd7f7630a90d9342
      size: 1788
    params:
      params.yaml:
        dataset.subset: HSN
        paths.polyphonic_data: data/${dataset.subset}/polyphonic
        paths.segmented_data: data/${dataset.subset}/segmented
        upload:
          huggingface_user: mcht67
          huggingface_dataset_name: PolyphonicBirdSet
